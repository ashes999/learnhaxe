<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="ashes999">
    <link rel="icon" href="content/favicon.ico">

    <title>Integration Testing in MUnit with HaxeFlixel | Learn Haxe</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="content/blog.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <link type="application/atom+xml" title="Learn Haxe" href="http://ashes999.github.io/learnhaxe/atom.xml" rel="alternate" />
</head>

  <body><script type="text/javascript">
if (window.location.href.indexOf('file://') == -1) {
  // Not locally viewing the file. Do your Google Analytics thing.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57858649-1', 'auto');
  ga('send', 'pageview');
}
</script>

    <div class="blog-masthead">
      <div class="container">
        <nav class="blog-nav">
          <a class="blog-nav-item" href="index.html">Home</a>
          <a class="blog-nav-item" href="about.html">About</a>
        </nav>
      </div>
    </div>

    <div class="container">

      <div class="blog-header">
        <h1 class="blog-title">Learn Haxe</h1>
        <p class="lead blog-description">An easier way to learn how to use the Haxe core and related technologies.</p>
      </div>

      <div class="row">

        <div class="col-sm-8 blog-main">

          <div class="blog-post">
            <h2 class="blog-post-title">Integration Testing in MUnit with HaxeFlixel</h2>
            <p class="blog-post-meta">Posted on 2016-03-28</p>
            <p><strong>Tagged with:</strong> <a href="tag-HaxeFlixel.html">HaxeFlixel</a></p>
<p>How can you test your HaxeFlixel game code? Testing games is tricky, because it's often hard to circumvent/simulate input (keyboard, mouse, etc.), and view code is often tightly coupled to logic.</p>
<p>HaxeFlixel's demos (probably inadvertantly) encourage a simple, direct style of development where you throw most of your code into states. This makes it difficult to test.</p>
<h3>Testing Strategies</h3>
<p>I suggest you use two strategies for testing:</p>
<p>1) As much as possible, <strong>write your logic in simple Haxe classes.</strong> Keep as much logic as you can out of <code>FlxState</code> classes, and try not to extend the Flixel classes.  This makes it difficult to handle things like "create a <code>Player</code> class that responds to keyboard input." To do this, you probably need an abstraction (method/event) in the <code>Player</code> class that responds to input, and some code in an <code>InputSystem</code> class or the <code>FlxState</code> that broadcasts input when it receives it from HaxeFlixel. Which brings me to the second strategy.</p>
<p>2) <strong>Test whatever is easy to test in your <code>FlxState</code> classes.</strong> You almost certainly cannot test everything (and have to go through great lengths to test everything). Sometimes, the cost and complexity doesn't justify the fragile tests. Test whatever you can reasonably test.</p>
<h3>Testing with HaxeFlixel</h3>
<p>Since unit testing simple Haxe classes with <code>munit</code> is easy, I documented the steps you need to set up integration testing.  The key is to realize that <strong>instead of using MUnit, you'll use lime as the test runner.</strong></p>
<p>Why? Because, as Gama11 mentioned <a href="https://groups.google.com/d/msg/haxeflixel/ow87nKG3t80/eKI4KFDtAAAJ">here</a>, HaxeFlixel relies on <code>lime</code> to build projects. Lime performs additional processing, like including libraries from <code>include.xml</code> files.</p>
<p>1) <strong>Delete your <code>test.hxml</code> file.</strong> You won't need it. </p>
<p>2)  <strong>Add a <code>project.xml</code> file to your <code>test</code> folder.</strong> You can use this as a starter.</p>
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;project&gt;
	&lt;meta title="UnitTests" version="1.0.0" /&gt;
	&lt;app file="TestMain" main="TestMain" /&gt;
	
	&lt;set name="SWF_VERSION" value="11.8" /&gt;
	&lt;source path="../src" /&gt;
	
	&lt;set name="no-custom-backend" /&gt;
	&lt;set name="unit-test" /&gt;
	
	&lt;haxelib name="munit" /&gt;
	&lt;haxelib name="flixel" /&gt;
	&lt;haxelib name="hamcrest" /&gt;
	
	&lt;haxedef name="FLX_UNIT_TEST" /&gt;
&lt;/project&gt;</code></pre>
<p>This transforms your <code>test</code> directory into a stand-alone HaxeFlixel project that you can build with <code>lime</code>.</p>
<p>3) <strong>Modify <code>TestMain.hx</code>.</strong> (If you don't have a copy, run <code>haxelib run munit test</code> to generate one.) Add two lines as the first two lines in the constructor:</p>
<pre><code>public function new()
{
   // Flixel was not designed for unit testing so we can only have one instance for now.
   Lib.current.stage.addChild(new FlxGame(800, 600, null, 1, 60, 60, true));
   // ...
}</code></pre>
<p>(The comment comes from the same line in the HaxeFlixel code base.)</p>
<p>That's it! Now you can write code instantiating and using <code>FlxState</code> instances like normal, and testing conditions.</p>
<p>To run the tests, just run <code>lime test &lt;platform&gt;</code> from the <code>test</code> directory. (Neko works out of the box; Flash requires some additional trickery to send the results to the MUnit test runner.)</p>

            <div id="disqus_thread"></div>
<script type="text/javascript">

var disqus_config = function () {
  this.page.url = "http://ashes999.github.io/learnhaxe/integration-testing-in-munit-with-haxeflixel"; // Absolute page URL
  this.page.identifier = "73e442436a0dbe9c5e3b943dd860f517f95b8a1d"; // Any unique, stable string identifier
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = 'http://butterflyhx.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

          </div>

          <!--nav>
            <ul class="pager">
              <li><a href="#">Previous</a></li>
              <li><a href="#">Next</a></li>
            </ul>
          </nav-->

        </div><!-- /.blog-main -->

        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          <div class="sidebar-module sidebar-module-inset">
            <h4>About</h4>
            <p>Short, direct, how-to articles about Haxe and the ecosystem. <a href="http://ashes999.github.io/learnhaxe/about.html">Read more</a></p>
          </div>
          <div class="sidebar-module">
            <h4>Tags</h4>
            <ul class="list-unstyled">
              <ul><li><a href="tag-Haxe.html">Haxe</a></li>
<li><a href="tag-HaxeFlixel.html">HaxeFlixel</a></li>
<li><a href="tag-Kha.html">Kha</a></li>
<li><a href="tag-Luxe.html">Luxe</a></li>
<li><a href="tag-OpenFL.html">OpenFL</a></li>
</ul>
            </ul>
          </div>
          <div class="sidebar-module">
            <h4>RSS Feed</h4>
            <a href="http://ashes999.github.io/learnhaxe/atom.xml"><img src="content/rss-icon.svg" width="64" height="64"</a>
          </div>
          <div class="sidebar-module">
            <h4>Elsewhere</h4>
            <ol class="list-unstyled">
              <li><a href="http://github.com/ashes999/learnhaxe">Learn Haxe source on GitHub</a></li>
            </ol>
          </div>
        </div><!-- /.blog-sidebar -->

      </div><!-- /.row -->

    </div><!-- /.container -->

    <footer class="blog-footer">
      <p>
        <a href="#">Back to top</a> ::
        crafted with <a href="https://github.com/ashes999/butterfly">Butterfly</a>
      </p>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://code.jquery.com/jquery-1.9.1.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>
  </body>
</html>
